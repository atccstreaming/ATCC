---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getSite } from '../content/site';
import { getLocaleFromPathname, withBasePath, type Locale } from '../i18n';

const { title, description } = Astro.props;
const locale: Locale = getLocaleFromPathname(Astro.url.pathname);
const site = getSite(locale);
const pageTitle = title ? `${title} · ${site.name}` : `${site.name} · ${site.nameEn}`;
const pageDescription = description ?? site.description;
const canonical = Astro.url;
const baseUrl = (import.meta as any).env?.BASE_URL ?? '/';
const backgroundUrl = withBasePath('/images/background.png');
---
<!doctype html>
<html lang={locale === 'en' ? 'en' : 'zh-Hans'} style={`--base-url: ${baseUrl}; --bg-image: url('${backgroundUrl}');`}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={pageDescription} />
    <link rel="canonical" href={canonical.toString()} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical.toString()} />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    <link rel="icon" href={withBasePath('/favicon.svg')} type="image/svg+xml" />
    <link rel="icon" href={withBasePath('/favicon.ico')} sizes="any" />
    <link rel="apple-touch-icon" href={withBasePath('/apple-touch-icon.png')} />
    <title>{pageTitle}</title>
  </head>
  <body class="min-h-dvh">
    <a
      href="#main"
      class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[60] focus:rounded-full focus:bg-ink-950 focus:px-4 focus:py-2 focus:text-sm focus:font-medium focus:text-parchment-50"
    >
      跳到主要内容
    </a>
    <Header />
    <main id="main">
      <slot />
    </main>
    <Footer />
  </body>
</html>
